digraph {
    graph [
        nodesep=0.60
        pad=2.0
        rankdir=LR
        ranksep=0.75
        splines=spline
    ]

    node [
        shape=box
        style=rounded

        // fixedsize=true
        height=1.4
        width=1.4
        
        fontcolor="#2D3436" 
        fontname="Sans-Serif" 
        fontsize=13
        
        imagescale=true 
        labelloc=b
    ]

    subgraph "cluster_DockerHub" {
        graph[
            label="DockerHub",
        ];
        
        builder_controller_image;
        builder_image
    }

    subgraph "cluster_k8s Cluster" {
        graph[
            label="k8s Cluster";
            rankdir=BT
        ];

        master;
        builder_controller;
        builder;

        builder_controller -> builder [label="create" constraint=false];
    }
    
    subgraph "cluster_GitHub" {
        graph[
            label="GitHub",
        ];

        subgraph cluster_repo {
            graph[
                label="repo",
            ];

            kubectl_plugin_repo;
            builder_controller_repo;
            builder_repo;
        }

        subgraph cluster_actions {
            graph[
                label="actions",
            ];

            kubectl_plugin_pipeline;
            builder_controller_pipeline;
            builder_pipeline;
        }
    }

    dev -> { kubectl_plugin_repo builder_controller_repo builder_repo} [label="push"]


    kubectl_plugin_repo -> kubectl_plugin_pipeline [label="trigger"];
    kubectl_plugin_pipeline -> master [label="deploy plugin"];
    
    builder_controller_repo -> builder_controller_pipeline [label="trigger"];
    builder_controller_pipeline -> builder_controller_image [label="build & package & push"];
    builder_controller_pipeline -> builder_controller [label="trigger deploy"];
    builder_controller -> builder_controller_image [label="pull" style=dashed]

    builder_repo -> builder_pipeline [label="trigger"];
    builder_pipeline -> builder_image [label="build & package & push"];
    builder_pipeline -> builder [label="trigger deploy"];
    builder -> builder_image [label="pull" style=dashed]
}